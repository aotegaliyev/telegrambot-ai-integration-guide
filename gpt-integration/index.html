
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A guide on how to integrate ChatGPT with a Telegram bot using instructor package">
      
      
        <meta name="author" content="OtegaliA">
      
      
        <link rel="canonical" href="https://aotegaliyev.github.io/telegrambot-ai-integration-guide/gpt-integration/">
      
      
        <link rel="prev" href="../app-guide/">
      
      
        <link rel="next" href="../results/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.2">
    
    
      
        <title>ChatGPT integration with Application - Telegram Bot AI Integration Guide</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="ChatGPT integration with Application - Telegram Bot AI Integration Guide" >
      
        <meta  property="og:description"  content="A guide on how to integrate ChatGPT with a Telegram bot using instructor package" >
      
        <meta  property="og:image"  content="https://aotegaliyev.github.io/telegrambot-ai-integration-guide/assets/images/social/gpt-integration.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://aotegaliyev.github.io/telegrambot-ai-integration-guide/gpt-integration/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="ChatGPT integration with Application - Telegram Bot AI Integration Guide" >
      
        <meta  name="twitter:description"  content="A guide on how to integrate ChatGPT with a Telegram bot using instructor package" >
      
        <meta  name="twitter:image"  content="https://aotegaliyev.github.io/telegrambot-ai-integration-guide/assets/images/social/gpt-integration.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="cyan" data-md-color-accent="cyan">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#integrating-chatgpt" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Telegram Bot AI Integration Guide" class="md-header__button md-logo" aria-label="Telegram Bot AI Integration Guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 9h3l-5 7m-4-7h4l-2 8M5 9h3l2 7m5-12h2l2 3h-3m-5-3h2l1 3h-4M7 4h2L8 7H5m1-5L2 8l10 14L22 8l-4-6H6Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Telegram Bot AI Integration Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ChatGPT integration with Application
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="cyan" data-md-color-accent="cyan"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="cyan" data-md-color-accent="cyan"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/aotegaliyev/telegrambot-ai-integration-guide" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aotegaliyev/telegrambot-ai-integration-guide
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<!-- Determine classes -->




<!-- Navigation -->
<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">

    <!-- Site title -->
    <label class="md-nav__title" for="__drawer">
        <a href=".." title="Telegram Bot AI Integration Guide"
            class="md-nav__button md-logo" aria-label="Telegram Bot AI Integration Guide" data-md-component="logo">
            
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 9h3l-5 7m-4-7h4l-2 8M5 9h3l2 7m5-12h2l2 3h-3m-5-3h2l1 3h-4M7 4h2L8 7H5m1-5L2 8l10 14L22 8l-4-6H6Z"/></svg>

        </a>
        Content
    </label>

    <!-- Repository information -->
    
    <div class="md-nav__source">
        <a href="https://github.com/aotegaliyev/telegrambot-ai-integration-guide" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aotegaliyev/telegrambot-ai-integration-guide
  </div>
</a>
    </div>
    

    <!-- Navigation list -->
    <ul class="md-nav__list" data-md-scrollfix>
        
        
        
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

        
        
        
  
  
  
  
    <li class="md-nav__item">
      <a href="../project-setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setting Up the Project
  </span>
  

      </a>
    </li>
  

        
        
        
  
  
  
  
    <li class="md-nav__item">
      <a href="../app-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Application initialization
  </span>
  

      </a>
    </li>
  

        
        
        
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    üçí ChatGPT integration with Application
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    üçí ChatGPT integration with Application
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#integrating-chatgpt" class="md-nav__link">
    <span class="md-ellipsis">
      Integrating ChatGPT
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integrating ChatGPT">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-integration-structure-and-response-model-schemas" class="md-nav__link">
    <span class="md-ellipsis">
      1 Integration structure and response model schemas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-define-env-variables" class="md-nav__link">
    <span class="md-ellipsis">
      2 Define ENV variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-chatgpt-client" class="md-nav__link">
    <span class="md-ellipsis">
      3 ChatGPT Client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-implementing-handle_task_to_algo" class="md-nav__link">
    <span class="md-ellipsis">
      4 üôãüèæ Implementing handle_task_to_algo
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-bot" class="md-nav__link">
    <span class="md-ellipsis">
      Run bot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Project structure
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

        
        
        
  
  
  
  
    <li class="md-nav__item">
      <a href="../results/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Results & Final Thoughts
  </span>
  

      </a>
    </li>
  

        
    </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#integrating-chatgpt" class="md-nav__link">
    <span class="md-ellipsis">
      Integrating ChatGPT
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integrating ChatGPT">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-integration-structure-and-response-model-schemas" class="md-nav__link">
    <span class="md-ellipsis">
      1 Integration structure and response model schemas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-define-env-variables" class="md-nav__link">
    <span class="md-ellipsis">
      2 Define ENV variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-chatgpt-client" class="md-nav__link">
    <span class="md-ellipsis">
      3 ChatGPT Client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-implementing-handle_task_to_algo" class="md-nav__link">
    <span class="md-ellipsis">
      4 üôãüèæ Implementing handle_task_to_algo
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-bot" class="md-nav__link">
    <span class="md-ellipsis">
      Run bot
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Project structure
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>üçí ChatGPT integration with Application</h1>

<div><h2 id="integrating-chatgpt"><strong>Integrating ChatGPT</strong><a class="headerlink" href="#integrating-chatgpt" title="Permanent link">¬∂</a></h2>
<p>At last, we've reached the <strong>pi√®ce de r√©sistance</strong>, the cherry on the cake of our project ‚Äì integrating ChatGPT! This is where things get really exciting, as we empower our bot with the brainpower of one of the most sophisticated language models out there.</p>
<h3 id="1-integration-structure-and-response-model-schemas">1 <strong>Integration structure and response model schemas</strong><a class="headerlink" href="#1-integration-structure-and-response-model-schemas" title="Permanent link">¬∂</a></h3>
<p>To weave this magic, we'll roll up our sleeves and introduce a dedicated <code>gpt</code> module. Within this, we'll craft specific files ‚Äì <code>client.py</code> for interacting with <strong>ChatGPT</strong> and <code>schemas.py</code> for structuring our data beautifully. This integration isn't just about adding smarts to our bot; it's about unlocking a whole new realm of possibilities, enabling it to converse, assist, and dazzle users like never before. Let's dive in and bring our bot to life with the power of ChatGPT!</p>
<p>Firstly lets configure our schema to parse result</p>
<div class="highlight"><pre><span></span><code><span class="c1"># schemas.py</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>


<span class="k">class</span> <span class="nc">Algorithm</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">order</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">class</span> <span class="nc">Task</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">algorithms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Algorithm</span><span class="p">]</span>
</code></pre></div>
<h3 id="2-define-env-variables">2 <strong>Define ENV variables</strong><a class="headerlink" href="#2-define-env-variables" title="Permanent link">¬∂</a></h3>
<p>We define OpenAI client with <strong>API_KEY</strong> that you can get from <a href="https://platform.openai.com/account/api-keys">open ai api-keys page</a>. We should update our <code>.env</code> file and <code>settings -&gt; –°onfig</code>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># settings.py</span>
<span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
    <span class="o">...</span>
    <span class="n">OPENAI_API_KEY</span> <span class="o">=</span>  <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">'OPENAI_API_KEY'</span><span class="p">)</span>
</code></pre></div>
<h3 id="3-chatgpt-client">3 <strong>ChatGPT Client</strong><a class="headerlink" href="#3-chatgpt-client" title="Permanent link">¬∂</a></h3>
<p>Next, we encapsulate it using the <code>instructor</code> package, utilizing a response model from schemas. To effectively integrate with <strong>ChatGPT</strong>, we must craft a precise prompt to elicit the correct response. Within <code>messages -&gt; content</code>, we provide specific instructions tailored to our use case.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># client.py</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">instructor</span>
<span class="kn">from</span> <span class="nn">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>

<span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">schemas</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">instructor</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span>
    <span class="n">OpenAI</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">Config</span><span class="o">.</span><span class="n">OPENAI_API_KEY</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="n">instructor</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">MD_JSON</span>
<span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">divide_task_to_algo</span><span class="p">(</span><span class="n">task</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">schemas</span><span class="o">.</span><span class="n">TaskDetail</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="s1">'gpt-4'</span><span class="p">,</span>
            <span class="n">response_model</span><span class="o">=</span><span class="n">schemas</span><span class="o">.</span><span class="n">TaskDetail</span><span class="p">,</span>
            <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
                <span class="p">{</span>
                    <span class="s1">'role'</span><span class="p">:</span> <span class="s1">'system'</span><span class="p">,</span>
                    <span class="s1">'content'</span><span class="p">:</span> <span class="p">(</span>
                        <span class="s1">'You can convert your task to algorithms '</span>
                        <span class="s1">'with its order and text.'</span>
                    <span class="p">),</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s1">'role'</span><span class="p">:</span> <span class="s1">'user'</span><span class="p">,</span>
                    <span class="s1">'content'</span><span class="p">:</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s1">'I have a task: </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s1">.'</span>
                        <span class="s1">'Please help me to convert it to algorithms.'</span>
                    <span class="p">)</span>
                <span class="p">},</span>
            <span class="p">],</span>
            <span class="n">max_tokens</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
<p>And then we should convert this response to readable text from telegram bot, todo so we should define class property that converts response data to readable text</p>
<div class="highlight"><pre><span></span><code><span class="c1"># schemas.py</span>
<span class="k">class</span> <span class="nc">TaskDetail</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">algorithms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Algorithm</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pretty_text</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s1">'Here is your algorithm:</span><span class="se">\n</span><span class="s1">'</span>
        <span class="n">algorithms</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">order</span><span class="si">}</span><span class="s1">) </span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">'</span>
                               <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithms</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">algorithms</span>
</code></pre></div>
<h3 id="4-implementing-handle_task_to_algo">4 <strong>üôãüèæ Implementing <code>handle_task_to_algo</code></strong><a class="headerlink" href="#4-implementing-handle_task_to_algo" title="Permanent link">¬∂</a></h3>
<p>Once we've nailed down these steps, it's time to treat all incoming Telegram bot messages as tasks that need breaking down into algorithms. The next crucial phase is to meld our bot with <strong>ChatGPT</strong>, which we achieve by embedding the necessary logic inside the <code>handle_task_to_algo</code> function. This step is key to refining our bot's brain, giving it the <strong>ChatGPT</strong>-powered boost it needs to interact intelligently and effectively.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># handlers.py</span>
<span class="kn">from</span> <span class="nn">telegram</span> <span class="kn">import</span> <span class="n">Update</span>
<span class="kn">from</span> <span class="nn">telegram.ext</span> <span class="kn">import</span> <span class="n">ContextTypes</span>
<span class="kn">from</span> <span class="nn">telegram.constants</span> <span class="kn">import</span> <span class="n">ChatAction</span>

<span class="kn">from</span> <span class="nn">gpt</span> <span class="kn">import</span> <span class="n">client</span> <span class="k">as</span> <span class="n">openai_client</span>
<span class="kn">from</span> <span class="nn">gpt.schemas</span> <span class="kn">import</span> <span class="n">TaskDetail</span>

<span class="c1"># Other handlers</span>
<span class="o">...</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">handle_task_to_algo</span><span class="p">(</span>
    <span class="n">update</span><span class="p">:</span> <span class="n">Update</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ContextTypes</span><span class="o">.</span><span class="n">DEFAULT_TYPE</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">await</span> <span class="n">context</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_chat_action</span><span class="p">(</span>
        <span class="n">chat_id</span><span class="o">=</span><span class="n">update</span><span class="o">.</span><span class="n">effective_message</span><span class="o">.</span><span class="n">chat_id</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="n">ChatAction</span><span class="o">.</span><span class="n">TYPING</span><span class="p">,</span>
    <span class="p">)</span>  <span class="c1"># Here we show typing animation in telegram chat</span>
    <span class="k">await</span> <span class="n">update</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">reply_text</span><span class="p">(</span><span class="s1">'üß† Processing...'</span><span class="p">)</span>

    <span class="n">task</span> <span class="o">=</span> <span class="n">update</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">text</span>
    <span class="n">task_detail</span><span class="p">:</span> <span class="n">TaskDetail</span> <span class="o">=</span> <span class="k">await</span> <span class="n">openai_client</span><span class="o">.</span><span class="n">divide_task_to_algo</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">task_detail</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">update</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">reply_text</span><span class="p">(</span>
            <span class="s1">'I could not convert your task to algorithms. üòî'</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">await</span> <span class="n">update</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">reply_text</span><span class="p">(</span><span class="n">task_detail</span><span class="o">.</span><span class="n">pretty_text</span><span class="p">)</span>
</code></pre></div>
<h2 id="run-bot"><strong>Run bot</strong><a class="headerlink" href="#run-bot" title="Permanent link">¬∂</a></h2>
<p>To start the bot just type in your project root:</p>
<div class="highlight"><pre><span></span><code>uvicorn app:app --reload
</code></pre></div>
<h2 id="project-structure"><strong>Project structure</strong><a class="headerlink" href="#project-structure" title="Permanent link">¬∂</a></h2>
<p>Final project structure should look like:</p>
<div class="highlight"><pre><span></span><code>project_root/
‚îÇ
‚îú‚îÄ‚îÄ gpt/                # Directory for GPT-related modules
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py     # Initializes the gpt package
‚îÇ   ‚îú‚îÄ‚îÄ client.py       # Contains the logic to interact with the ChatGPT API
‚îÇ   ‚îî‚îÄ‚îÄ schemas.py      # Defines pydantic models for ChatGPT data structures
‚îÇ
‚îú‚îÄ‚îÄ taskalgobot/        # Directory for Telegram bot-specific modules
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py     # Initializes the taskalgobot package
‚îÇ   ‚îú‚îÄ‚îÄ handlers.py     # Contains handler functions for different bot commands
‚îÇ   ‚îî‚îÄ‚îÄ keyboards.py    # Defines custom keyboards for the bot interface
‚îÇ
‚îú‚îÄ‚îÄ app.py              # Main application entry point
‚îú‚îÄ‚îÄ requirements.txt    # Lists all necessary Python dependencies
‚îú‚îÄ‚îÄ .env                # Stores environment variables for local development
‚îî‚îÄ‚îÄ .env.example        # Provides a template for setting up .env files
</code></pre></div>
<p>And there we have it, folks! We've journeyed through the code jungle and emerged with a bot that's not just smart but ChatGPT-smart. Now, who's ready for the grand finale? Let's roll out the red carpet and unveil the fruits of our labor. Get your popcorn ready because the results of this tutorial are about to dazzle and amuse. Drumroll, please! ü•Åüéâ</p></div>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../app-guide/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Application initialization">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Application initialization
              </div>
            </div>
          </a>
        
        
          
          <a href="../results/" class="md-footer__link md-footer__link--next" aria-label="Next: Results &amp; Final Thoughts">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Results & Final Thoughts
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 OtegaliA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://t.me/a5eke" target="_blank" rel="noopener" title="Telegram Chat" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M248 8C111.033 8 0 119.033 0 256s111.033 248 248 248 248-111.033 248-248S384.967 8 248 8Zm114.952 168.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452 0 0 1 3.53 6.716 43.765 43.765 0 0 1 .417 9.769Z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://github.com/aotegaliyev" target="_blank" rel="noopener" title="GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  
    
  



  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections", "search.share", "navigation.footer", "content.code.copy"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>